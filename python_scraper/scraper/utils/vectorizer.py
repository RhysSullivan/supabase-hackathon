import logging

import numpy as np
import voyageai
from dotenv import load_dotenv
from scraper.utils.supabase_client import SupabaseClient

# Configure logging
logging.basicConfig(level=logging.INFO)

load_dotenv()
vo = voyageai.Client()
supabase_client = SupabaseClient()


def get_embedding(text: str) -> list[float]:
    logging.info(f"Generating embedding for text: {text}")
    result = vo.embed([text], model="voyage-3", input_type="document")
    embedding = result.embeddings[0]
    logging.info(f"Generated embedding: {len(embedding)}")
    return embedding


def query_embeddings(query: str, n: int = 10) -> list[list[float]]:
    result = vo.embed([query], model="voyage-3", input_type="query")
    return result.embeddings


def cosine_distance(embedding1: list[float], embedding2: list[float]) -> float:
    """Calculate the cosine distance between two embeddings."""
    dot_product = np.dot(embedding1, embedding2)
    norm_a = np.linalg.norm(embedding1)
    norm_b = np.linalg.norm(embedding2)
    return 1 - (dot_product / (norm_a * norm_b))


if __name__ == "__main__":
    title_embedding = [
        0.013778842,
        -0.008281087,
        -0.0141947325,
        -0.016665267,
        0.053937014,
        0.03011739,
        0.03555532,
        -0.007163587,
        0.017823871,
        0.015985372,
        -0.0637451,
        0.016605081,
        -0.109418765,
        -0.038572177,
        -0.0055600577,
        -0.00018442755,
        -0.0046210033,
        0.013394308,
        0.021066826,
        0.010724029,
        -0.0013194615,
        0.011800062,
        -0.029478703,
        -0.0016693375,
        -0.0342928,
        0.04462569,
        0.015469635,
        0.028937384,
        0.02827064,
        -0.011029346,
        -0.052722353,
        -0.040493194,
        -0.0021396896,
        -0.03882468,
        0.01515029,
        0.025732389,
        0.016208196,
        0.0011536005,
        0.018490616,
        -0.04446396,
        -0.03066201,
        -0.005890129,
        0.0011882581,
        0.014953073,
        -0.020517256,
        0.033304233,
        0.008508422,
        -0.011405627,
        0.00294754,
        -0.029589277,
        3.9505452e-05,
        -0.02734644,
        -0.0051392163,
        0.074064784,
        0.009572491,
        0.036070235,
        -0.010233873,
        -0.024339486,
        0.0005161496,
        -0.0055831624,
        0.008324408,
        0.036367297,
        -0.0043684985,
        0.037080254,
        0.006466104,
        0.020236695,
        0.026933849,
        -0.00354497,
        -0.006794526,
        -0.03978684,
        -0.038860578,
        0.011446886,
        -0.0037364115,
        -0.005185426,
        0.0034409973,
        -0.0022246833,
        -0.043424234,
        0.014047026,
        -0.016597655,
        -0.006253208,
        0.017232217,
        0.009450571,
        -0.037397124,
        -0.020596936,
        -0.05087065,
        0.040742397,
        0.021385346,
        0.013122412,
        -0.011701041,
        -0.025576018,
        -0.032828927,
        0.0010829446,
        0.012585633,
        0.029359877,
        -0.008892544,
        -0.043386273,
        0.0055995625,
        -0.0037383712,
        0.06510004,
        -0.016868314,
        0.014652708,
        -0.045087792,
        0.023131423,
        -0.06328134,
        0.03765458,
        -0.04377617,
        0.009918654,
        -0.013156657,
        0.024227262,
        0.015678406,
        -0.01961781,
        -0.00019391712,
        0.013624533,
        0.0058488706,
        0.006202408,
        -0.006911701,
        0.038420346,
        -0.049890336,
        -0.03476315,
        0.08003578,
        -0.020312611,
        0.046477392,
        0.008397848,
        0.016084393,
        -0.06306844,
        0.039671313,
        0.022256734,
        -0.017533407,
        -0.07640169,
        -0.00062424806,
        0.013463624,
        -0.033440385,
        0.020383473,
        -0.0741209,
        0.055118673,
        0.043292202,
        0.010091942,
        0.011341264,
        -0.0018826463,
        0.021205405,
        0.01293551,
        -0.019814203,
        -0.027858049,
        -0.019154884,
        -0.011173391,
        -0.015031052,
        0.009931857,
        0.0015389593,
        0.008720494,
        0.01362866,
        0.02153037,
        -0.021580085,
        0.0029896242,
        0.01786183,
        0.0005446183,
        -0.10047382,
        -0.027683113,
        0.0032769928,
        0.015328529,
        0.031696785,
        0.006561825,
        0.012773775,
        0.02799008,
        -0.008911936,
        -0.03186677,
        -0.03715617,
        0.013363571,
        0.022572003,
        -0.024818089,
        0.033297632,
        0.04094209,
        -0.028438976,
        0.013612981,
        -0.03393797,
        -0.034188826,
        0.014786386,
        -0.012080624,
        0.0065981327,
        0.0036802993,
        0.007440641,
        -0.0048784595,
        -0.014731099,
        0.0076180543,
        0.0013149232,
        -0.01489696,
        -0.014117991,
        -0.035017304,
        -0.00888945,
        -0.00230225,
        -0.00865448,
        0.0065997834,
        -0.009312509,
        0.00043321907,
        -0.023454895,
        0.007248374,
        0.032345373,
        -0.04907506,
        -0.01956995,
        -0.019911988,
        0.017503701,
        0.041153338,
        -0.013318392,
        -0.016962383,
        0.016260982,
        0.03153835,
        -0.020269701,
        -0.01291323,
        0.043034747,
        0.023100892,
        -0.014514903,
        -0.010280082,
        0.039087087,
        0.014892834,
        0.037374016,
        -0.015628895,
        -0.040163122,
        0.053296678,
        -0.050360687,
        0.042075887,
        0.021098183,
        0.04829681,
        -0.04780428,
        0.035509113,
        -0.033663183,
        0.017889885,
        0.015974645,
        -0.033419758,
        -0.01882729,
        0.03982645,
        -0.027491568,
        0.0511083,
        0.031083675,
        -0.002067899,
        -0.017788595,
        0.01570646,
        0.006987618,
        -0.014285502,
        0.046524428,
        0.017701743,
        0.041361284,
        -0.045134,
        0.039357748,
        0.0399296,
        -0.032917842,
        -0.0036986596,
        0.0016730508,
        -0.016308842,
        0.016703174,
        -0.05695717,
        0.011002939,
        0.029214645,
        -0.027415754,
        0.02035057,
        -0.014566063,
        0.019180465,
        0.0019375208,
        -0.0003251206,
        -0.024973223,
        0.005829066,
        0.030001866,
        0.01739519,
        -0.015105731,
        -0.0022081796,
        0.008156277,
        0.037499443,
        0.009611688,
        -0.0027152523,
        -0.05865374,
        -0.037786607,
        -0.036674265,
        -0.04393254,
        -0.017597359,
        0.028290443,
        0.027769757,
        -0.030865002,
        -0.02187158,
        -0.051669423,
        -0.0029007113,
        0.009258511,
        0.0021260742,
        -0.0161207,
        0.04046844,
        0.021217009,
        -0.005489092,
        -0.0061855437,
        -0.026283607,
        -0.004251323,
        -0.014467042,
        0.02413154,
        -0.04277894,
        0.0108725615,
        -0.00020093113,
        0.0010661315,
        0.030498624,
        0.08077514,
        0.002201578,
        0.0029326868,
        -0.020106317,
        -0.0002941764,
        -0.04771021,
        -0.00062466064,
        -0.04241751,
        0.018292572,
        0.023240346,
        -0.012560053,
        0.023329467,
        -0.0008622607,
        0.014443937,
        -0.024075428,
        -0.01874477,
        0.022398664,
        -0.0414339,
        0.03851029,
        -0.013763989,
        0.017376624,
        0.00723414,
        0.05433475,
        0.07559188,
        0.0049543763,
        0.0013466924,
        -0.050141603,
        -0.0005784506,
        0.011676699,
        -0.022349155,
        -0.0029157707,
        0.040222537,
        0.04093054,
        0.0013438043,
        0.015831476,
        -0.016218072,
        0.047563333,
        0.05370514,
        0.003011904,
        -0.026550965,
        0.0117703555,
        -0.02422066,
        -0.026800994,
        -0.04773662,
        -0.036634658,
        0.0308485,
        -0.010252027,
        -0.030538233,
        -0.03954589,
        0.0035622986,
        0.02269573,
        -0.007818573,
        0.045440968,
        0.008368968,
        -0.009297295,
        0.047591385,
        0.012692082,
        0.017533407,
        -0.040130116,
        -0.0057250937,
        -0.018125886,
        0.03909039,
        -0.026610378,
        0.020655062,
        0.017071307,
        0.02179876,
        0.0048091444,
        -0.03209947,
        -0.010355174,
        0.021572454,
        0.050012458,
        -0.010804277,
        0.044671904,
        -0.00681598,
        0.0057684155,
        -0.034419876,
        0.057627212,
        0.052481398,
        -0.01787008,
        -0.012367786,
        0.015394543,
        -0.004249673,
        -0.041947987,
        -0.0029458897,
        -0.04701541,
        0.010412111,
        0.052732255,
        -0.019284027,
        0.034795333,
        0.012981719,
        -0.01905999,
        0.002523398,
        0.026303412,
        -0.054448623,
        -0.011677937,
        0.010245863,
        -0.030197432,
        0.02195967,
        0.045609307,
        -0.0057432475,
        0.027831646,
        -0.004673815,
        0.008020742,
        0.009127308,
        0.0706502,
        -0.02915523,
        -0.025073897,
        0.009707511,
        0.027382283,
        0.033680514,
        0.00879641,
        -0.04809144,
        0.0036233617,
        -0.004741067,
        0.010863485,
        0.027638553,
        0.019464327,
        0.012574081,
        0.01086596,
        0.013799473,
        0.04040531,
        -0.004581395,
        0.028516542,
        0.016231274,
        -0.029759675,
        -0.054569103,
        -0.036123045,
        -0.011611922,
        0.014074257,
        0.0068085534,
        0.039229844,
        -0.04788185,
        -0.04310076,
        -0.0033535282,
        -0.0069998405,
        0.0674683,
        0.020687243,
        0.01906494,
        0.009433449,
        0.07886073,
        0.052190933,
        -0.0054857912,
        0.012652473,
        0.007880461,
        0.015410222,
        0.021098183,
        -0.06594832,
        -0.0093410285,
        0.0014344709,
        -0.049033802,
        0.055356324,
        0.019539418,
        -0.01526004,
        -0.001466756,
        0.06461649,
        -0.013396784,
        0.010776325,
        0.013021328,
        0.018723316,
        0.005733345,
        0.0048461226,
        0.05499448,
        0.023380628,
        -0.01901254,
        0.013503232,
        -0.0066798255,
        -0.037067723,
        -0.012549326,
        0.0069150017,
        0.018120935,
        0.013503232,
        -0.0004984082,
        -0.0057465476,
        -0.0061756414,
        -0.031813957,
        0.07334193,
        0.03148554,
        0.00040928888,
        -0.0033914866,
        -0.053237263,
        0.013513134,
        0.05166282,
        0.02281373,
        -0.010473174,
        0.008764602,
        0.03632769,
        -0.008786508,
        -0.016147107,
        0.006735113,
        -0.03146243,
        0.022435797,
        -0.025379213,
        0.019483512,
        0.011557873,
        -0.052904714,
        -0.026075663,
        0.013930881,
        0.042935725,
        0.047353733,
        0.030777121,
        0.013532938,
        -0.08167385,
        -0.003099373,
        0.013280434,
        0.021362238,
        -0.03671057,
        0.05609238,
        0.009375686,
        -0.0039307415,
        0.044037748,
        0.032608606,
        -0.05046136,
        0.02518447,
        -0.008521626,
        -0.008060866,
        -0.018780474,
        -0.04205113,
        0.033786137,
        0.021705514,
        0.009939283,
        0.037733797,
        0.014070956,
        0.011114338,
        -0.0046342066,
        0.0015975469,
        -0.025105251,
        0.00911658,
        -0.029133778,
        0.019961085,
        0.035031747,
        -0.006949659,
        -0.042147677,
        -0.008727095,
        -0.040691238,
        0.011024395,
        0.0015249312,
        -0.004897542,
        -0.03826686,
        0.046569813,
        -0.039524432,
        0.035806175,
        -0.018616043,
        -0.021679107,
        0.0042620506,
        -0.028579257,
        -0.027737575,
        -0.005216783,
        0.00076514744,
        -0.02794057,
        0.047437903,
        -0.025469156,
        -0.0014754204,
        -0.03688551,
        -0.0057267435,
        -0.047078125,
        0.024555681,
        -0.017102664,
        0.024762804,
        -0.024481416,
        -0.048134353,
        0.037879027,
        -0.031145563,
        0.002965694,
        0.009729895,
        0.056151792,
        0.027075779,
        -0.06621898,
        0.0002219732,
        0.0323528,
        -0.029293861,
        -0.017639032,
        -0.022672625,
        0.043076005,
        -0.05603627,
        -0.061274506,
        0.022550497,
        0.02311657,
        -0.029920999,
        -0.040400773,
        -0.007292109,
        0.040418103,
        0.024002813,
        0.01017776,
        -0.017268112,
        -0.021712117,
        -0.008649528,
        0.014014844,
        -0.063637815,
        -0.027217712,
        -0.021559045,
        0.006324174,
        0.07890694,
        0.014678288,
        0.0057539744,
        -0.041760672,
        -0.030482119,
        0.0071559544,
        -0.00043074356,
        0.03841374,
        -0.037773404,
        -0.02305881,
        -0.014495098,
        -0.021043722,
        0.01589295,
        -0.03524918,
        -0.027772233,
        -0.011793462,
        -0.0058932235,
        0.048428115,
        -0.032706805,
        -0.052395582,
        -0.039583024,
        0.038831282,
        -0.010299887,
        0.041176446,
        -0.015373088,
        0.01618259,
        -0.047444504,
        -0.08750365,
        -0.043912735,
        0.02776398,
        0.024084505,
        -0.009327826,
        -0.03375808,
        0.02330306,
        0.010390657,
        0.015024863,
        -0.007538837,
        -0.010058935,
        0.014027222,
        0.0112801995,
        0.016615808,
        0.025416963,
        0.0042789667,
        -0.0014259097,
        0.016318744,
        0.07753053,
        -0.01404125,
        -0.020183884,
        0.024247067,
        -0.032941155,
        0.038743816,
        -0.0098476885,
        -0.0076234182,
        0.011087933,
        -0.0303373,
        0.003485557,
        -0.009536596,
        -0.017437687,
        0.043495197,
        0.049061853,
        -0.009707615,
        -0.011364162,
        -0.03082787,
        -0.0028056095,
        0.030211462,
        0.006746665,
        -0.04108072,
        -0.029168846,
        -0.059056427,
        -0.02094965,
        -0.02682245,
        -0.011504649,
        0.018305775,
        -0.009106678,
        -0.023766812,
        0.021980712,
        -0.038047362,
        0.0038614261,
        -0.027513126,
        -0.027307242,
        0.03083117,
        -0.016520089,
        -0.050437942,
        -0.04453575,
        -0.080326244,
        -0.008459737,
        -0.00040268747,
        0.013938308,
        0.023322864,
        -0.039975807,
        -0.027422355,
        0.0072417725,
        -0.0051912023,
        0.005609568,
        -0.0134677505,
        -0.05776832,
        -0.016450774,
        0.022439925,
        0.03139972,
        0.07379743,
        0.03829244,
        0.027277125,
        -0.03358149,
        -0.04121275,
        -0.039819848,
        -0.06591366,
        0.04444745,
        -0.0069236658,
        -0.0017163727,
        -0.054169714,
        -5.6937366e-05,
        -0.01061624,
        0.016274184,
        0.05654788,
        -0.015468809,
        0.020705396,
        0.037244465,
        -0.0005446183,
        0.04055178,
        0.009641394,
        0.017686067,
        -0.0483489,
        0.069447085,
        -0.03872401,
        -0.014070956,
        0.00750583,
        0.059056427,
        0.007475299,
        0.08331009,
        0.0064264955,
        0.010846156,
        0.04948435,
        -0.022254258,
        -0.0059247864,
        -0.019008003,
        -0.019871863,
        0.00040928888,
        0.0032677096,
        -0.029364828,
        -0.06506373,
        -0.008877278,
        -0.035049487,
        -0.06202047,
        -0.02753128,
        0.00020711997,
        0.0083161555,
        -0.030086033,
        -0.04871858,
        0.002186725,
        -0.004400681,
        -0.022123056,
        -0.03940726,
        -0.017198745,
        0.0725085,
        0.05703639,
        0.03585569,
        -0.022449827,
        0.009725562,
        0.012794816,
        0.012876921,
        -0.060029313,
        0.038460366,
        0.024568887,
        -0.0768902,
        0.028187295,
        0.022552973,
        0.035179865,
        -0.014490147,
        -0.01441258,
        -0.009337109,
        -0.008968048,
        0.03415417,
        0.004208414,
        -0.038717408,
        -0.006340677,
        0.023273354,
        -0.04644439,
        0.02587762,
        0.046985704,
        -0.04207754,
        0.010895667,
        -0.017627478,
        -0.0068126796,
        0.046137422,
        -0.0009841294,
        -0.0010463272,
        0.00036637957,
        0.00926635,
        0.013017898,
        -0.012791929,
        -0.015222906,
        -0.019695377,
        -0.041932303,
        -0.021068476,
        0.040002417,
        -0.02555415,
        0.054157335,
        0.042886212,
        -0.019718483,
        0.015061171,
        0.046375073,
        0.01772815,
        -0.00044270864,
        0.04764915,
        -0.027980177,
        -0.011615222,
        -0.0039526084,
        -0.003356829,
        -0.00994671,
        -0.02182434,
        0.01791464,
        0.034721065,
        0.0069892677,
        -0.027759854,
        0.02771282,
        -0.002396733,
        0.011837609,
        0.09914693,
        -0.0644465,
        -0.026816675,
        0.02808415,
        0.049220286,
        0.0077649364,
        0.025752194,
        -0.08064312,
        -0.027173564,
        -0.003592005,
        -0.011988203,
        0.06206503,
        0.011266997,
        0.006901799,
        -0.027106313,
        -0.024600241,
        -0.00405328,
        -0.0059974026,
        -0.018335482,
        0.053416323,
        -0.014160075,
        0.0036637958,
        0.024348564,
        0.005538603,
        -0.049182333,
        -0.0020837837,
        -0.05488659,
        0.056627095,
        -0.0029310365,
        0.016629836,
        -0.008348338,
        -0.011167253,
        0.010308139,
        -0.024425305,
        -0.05403273,
        0.029466428,
        0.07809496,
        -0.073381536,
        0.0009885647,
        0.10377454,
        0.029673446,
        -0.023690172,
        -0.035987716,
        -0.052111715,
        0.02476528,
        -0.027296929,
        -0.0018021914,
        -0.0200337,
        -0.041082375,
        -0.003236353,
        0.06684529,
        0.046375073,
        -0.06315261,
        -0.032918047,
        0.0064087543,
        0.0034657526,
        0.042214517,
        0.030307183,
        -0.054107,
        0.0037727193,
        0.05613529,
        0.022227028,
        -0.008295527,
        -0.019092996,
        -0.047305875,
        0.021952655,
        0.017361771,
        0.020304669,
        0.005805961,
        0.025166316,
        -0.0060960115,
        0.019776244,
        0.0075794775,
        0.0068192813,
        0.076622844,
        0.02459034,
        0.05741762,
        -0.008387121,
        -0.03416407,
        0.025844613,
        0.020391004,
        0.034083202,
        -0.004553339,
        -0.027966768,
        -0.0069636875,
        -0.016173514,
        0.0090819225,
        0.0345288,
        0.014447237,
        0.024658006,
        -0.03200705,
        -0.010554867,
        0.022762569,
        -0.011184479,
        -0.022817854,
        0.007750083,
        0.06431116,
        0.0122110015,
        -0.049801216,
        0.09878385,
        0.0026438741,
        -0.034388516,
        -0.0006481783,
        -0.0071462584,
        -0.06188184,
        0.05819824,
        0.043014944,
        0.020431437,
        0.0041921167,
        0.019985842,
        0.013480128,
        0.0071072686,
        -0.008413527,
        0.015137087,
        -0.06219541,
        -0.011912287,
        -0.0026603776,
        -0.034129415,
        0.019829057,
        0.010281733,
        0.0024012716,
        0.020147575,
        0.010845331,
        0.051365755,
        0.017190134,
        -0.0018583037,
        -0.0040813363,
        0.017122468,
        0.008416209,
        -0.00013677345,
        0.005774604,
        0.061513808,
        -0.028805356,
        0.027805239,
        0.01671153,
        -0.01878933,
        -0.089838915,
        -0.050840944,
        0.003982315,
        0.036494374,
        -0.031601064,
        -0.055376127,
        -0.022497686,
        -0.041754067,
        -0.009570428,
        0.018292792,
        -0.06586251,
        0.025941983,
        -0.009037363,
        -0.016782494,
        0.00805705,
        0.054686274,
        -0.036635276,
        0.06083881,
        -0.010068837,
        -0.057264138,
        0.029917696,
        -0.056884553,
        0.030574542,
        0.0033906612,
        0.029414339,
        -0.0035928304,
        -0.007861689,
        0.056782234,
        -0.005505596,
        -0.07130374,
        0.01379287,
        0.03428166,
        -0.041364584,
        -0.016578676,
        0.03288174,
        0.012707761,
        0.034296576,
        0.020880336,
        0.025408918,
        0.026610378,
        -0.053352788,
        -0.047041815,
        0.026415637,
        -0.016600955,
        -0.03043426,
        -0.030800434,
        0.017794164,
        -0.032634187,
        -0.06350579,
        -0.0039344546,
        -0.028188948,
        -0.009780024,
        -0.033814605,
        -0.025024591,
        0.016808901,
        -0.013473526,
        0.028585857,
        -0.009808286,
        -0.03411621,
        0.00030552258,
        -0.0025877622,
        0.05667991,
        -0.027658358,
        -0.004990684,
        -0.010892365,
        -0.014057753,
        -0.016652117,
        -0.0023930199,
        -0.047903303,
        -0.016374856,
        -0.0028705923,
        0.009004355,
        0.046357743,
        0.008324614,
        0.0644894,
        -0.027088467,
        0.008517087,
        0.026467623,
        -0.029413514,
        -0.04121935,
        0.010755385,
        0.012009659,
        0.007857356,
        -0.05659244,
        0.03389506,
        0.035660945,
    ]

    query_embedding = np.array(
        query_embeddings(
            "tell me about the registered businesses in San Francisco", n=1
        )
    ).flatten()
    # print(query_embedding)
    print(cosine_distance(title_embedding, query_embedding))
